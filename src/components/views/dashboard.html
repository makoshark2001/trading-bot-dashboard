<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Trading Bot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        body { 
            background-color: #0d1117; 
            color: #f0f6fc; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            overflow-x: hidden;
        }
        .container-fluid {
            max-width: 100vw;
            overflow-x: hidden;
        }
        .card { 
            background-color: #161b22; 
            border: 1px solid #30363d;
            color: #f0f6fc; 
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: #58a6ff;
            box-shadow: 0 0 0 1px #58a6ff;
        }
        .card-body {
            overflow: hidden;
            padding: 1rem;
        }
        .card-header {
            background-color: #21262d;
            border-bottom: 1px solid #30363d;
            padding: 0.75rem 1rem;
        }
        
        /* Enhanced Badge Styles */
        .badge-buy { 
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            box-shadow: 0 2px 4px rgba(35, 134, 54, 0.3);
        }
        .badge-sell { 
            background: linear-gradient(135deg, #da3633, #f85149);
            color: white;
            box-shadow: 0 2px 4px rgba(218, 54, 51, 0.3);
        }
        .badge-hold { 
            background: linear-gradient(135deg, #9a6700, #bf8700);
            color: white;
            box-shadow: 0 2px 4px rgba(154, 103, 0, 0.3);
        }
        
        /* Confidence Indicators */
        .confidence-bar {
            height: 4px;
            border-radius: 2px;
            margin-top: 2px;
            transition: width 0.3s ease;
        }
        .confidence-high { background: linear-gradient(90deg, #238636, #2ea043); }
        .confidence-medium { background: linear-gradient(90deg, #bf8700, #d29922); }
        .confidence-low { background: linear-gradient(90deg, #6e7681, #8b949e); }
        
        /* Tabs */
        .nav-tabs {
            border-bottom: 1px solid #30363d;
        }
        .nav-tabs .nav-link {
            color: #8b949e;
            border: none;
            background: transparent;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        .nav-tabs .nav-link:hover {
            color: #f0f6fc;
            border: none;
        }
        .nav-tabs .nav-link.active {
            color: #58a6ff;
            background: transparent;
            border: none;
            border-bottom: 2px solid #58a6ff;
        }
        
        /* Indicator Cards */
        .indicator-card {
            background-color: #0d1117;
            border: 1px solid #21262d;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }
        .indicator-card:hover {
            background-color: #161b22;
            border-color: #30363d;
        }
        
        /* Summary Stats */
        .summary-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .stat-item {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            background-color: #0d1117;
            border-radius: 6px;
            border: 1px solid #21262d;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        .stat-label {
            font-size: 0.75rem;
            color: #8b949e;
            text-transform: uppercase;
        }
        
        /* Price Chart */
        .price-chart { 
            height: 200px; 
            width: 100% !important;
            max-width: 100%;
        }
        .chart-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        /* Status Indicators */
        .status-online { color: #3fb950; }
        .status-offline { color: #f85149; }
        .navbar-dark { background-color: #21262d !important; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .summary-stats {
                flex-direction: column;
                gap: 0.5rem;
            }
            .nav-tabs .nav-link {
                font-size: 0.75rem;
                padding: 0.375rem 0.75rem;
            }
        }
        
        /* Loading Animation */
        .loading-pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Ensemble Signal Highlight */
        .ensemble-signal {
            background: linear-gradient(135deg, #1f2937, #374151);
            border: 2px solid #58a6ff;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .ensemble-signal .signal-strength {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        /* Trend Indicators */
        .trend-up { color: #3fb950; }
        .trend-down { color: #f85149; }
        .trend-neutral { color: #8b949e; }

        /* Performance Metrics Text Visibility Fix */
        #performance-metrics .h4 {
            color: #f0f6fc !important;
            font-weight: 600;
        }

        #performance-metrics .text-muted {
            color: #8b949e !important;
        }

        #performance-metrics .text-center {
            padding: 0.5rem;
        }

        /* Enhanced Performance Metrics Styling */
        #performance-metrics .col-md-2 {
            border-right: 1px solid #30363d;
        }

        #performance-metrics .col-md-2:last-child {
            border-right: none;
        }

        /* Add subtle background for better visibility */
        .performance-metric-item {
            background-color: #161b22;
            border-radius: 6px;
            padding: 0.75rem;
            margin: 0.25rem;
            border: 1px solid #21262d;
            transition: all 0.2s ease;
        }

        .performance-metric-item:hover {
            background-color: #21262d;
            border-color: #30363d;
        }

        /* Value styling with better contrast */
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f0f6fc !important;
            margin-bottom: 0.25rem;
            line-height: 1.2;
        }

        .metric-label {
            font-size: 0.75rem;
            color: #8b949e !important;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Color coding for different metric types */
        .metric-positive { color: #3fb950 !important; }
        .metric-negative { color: #f85149 !important; }
        .metric-neutral { color: #58a6ff !important; }
        .metric-warning { color: #d29922 !important; }

    </style>
</head>
<body>
    <nav class="navbar navbar-dark navbar-expand-lg mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                üöÄ Advanced Trading Bot
                <span class="badge bg-primary ms-2" id="indicator-count">11 Indicators</span>
            </span>
            <div class="navbar-nav ms-auto">
                <span class="nav-link">
                    <span id="status-indicator" class="status-offline">‚óè</span>
                    <span id="uptime">00:00:00</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <!-- System Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üìä System Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Status:</strong>
                                <span id="data-status" class="ms-2 loading-pulse">Loading...</span>
                            </div>
                            <div class="col-md-3">
                                <strong>Data Points:</strong>
                                <span id="total-data-points" class="ms-2">0</span>
                            </div>
                            <div class="col-md-3">
                                <strong>API:</strong>
                                <span id="api-status" class="ms-2 loading-pulse">Loading...</span>
                            </div>
                            <div class="col-md-3">
                                <strong>Last Update:</strong>
                                <span id="last-update" class="ms-2">Never</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Performance Metrics -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üìà Performance Metrics</h5>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-primary active" id="metrics-1h">1H</button>
                            <button type="button" class="btn btn-outline-primary" id="metrics-4h">4H</button>
                            <button type="button" class="btn btn-outline-primary" id="metrics-1d">1D</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row" id="performance-metrics">
                            <div class="col-md-2">
                                <div class="performance-metric-item text-center">
                                    <div class="metric-value" id="accuracy-rate">--</div>
                                    <div class="metric-label">Signal Accuracy</div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="performance-metric-item text-center">
                                    <div class="metric-value" id="total-signals">--</div>
                                    <div class="metric-label">Total Signals</div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="performance-metric-item text-center">
                                    <div class="metric-value metric-positive" id="best-performer">--</div>
                                    <div class="metric-label">Best Indicator</div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="performance-metric-item text-center">
                                    <div class="metric-value metric-neutral" id="avg-confidence">--</div>
                                    <div class="metric-label">Avg Confidence</div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="performance-metric-item text-center">
                                    <div class="metric-value" id="consensus-rate">--</div>
                                    <div class="metric-label">Consensus Rate</div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="performance-metric-item text-center">
                                    <div class="metric-value metric-warning" id="volatility-index">--</div>
                                    <div class="metric-label">Market Volatility</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Pairs -->
        <div class="row" id="pairs-container">
            <!-- Pairs will be populated here -->
        </div>
    </div>

    <script>
        var charts = {};
        var isOnline = false;

        // Configuration
        const INDICATOR_GROUPS = {
            trend: ['rsi', 'macd', 'ma', 'adx', 'parabolicSAR', 'ichimoku'],
            momentum: ['stochastic', 'williamsR', 'cci', 'bollinger'],
            volume: ['volume']
        };

        const INDICATOR_NAMES = {
            rsi: 'RSI',
            macd: 'MACD',
            bollinger: 'Bollinger Bands',
            ma: 'Moving Average',
            volume: 'Volume',
            stochastic: 'Stochastic',
            williamsR: 'Williams %R',
            ichimoku: 'Ichimoku Cloud',
            adx: 'ADX',
            cci: 'CCI',
            parabolicSAR: 'Parabolic SAR'
        };

        
        
        // Add this to your main dashboard script
        function updatePerformanceMetrics(allPairsData) {
            // Calculate mock performance metrics (you can enhance this with real data later)
            let totalSignals = 0;
            let totalConfidence = 0;
            let consensusCount = 0;
            let indicatorPerformance = {};
            
            // Initialize indicator performance tracking
            Object.keys(INDICATOR_NAMES).forEach(indicator => {
                indicatorPerformance[indicator] = { signals: 0, confidence: 0 };
            });
            
            // Process all pairs data
            allPairsData.pairs.forEach(pair => {
                const strategies = allPairsData.strategyResults[pair];
                if (!strategies) return;
                
                let pairSignals = 0;
                let pairConfidence = 0;
                let bullish = 0, bearish = 0;
                
                Object.entries(strategies).forEach(([indicator, data]) => {
                    if (data && !data.error && data.confidence) {
                        pairSignals++;
                        totalSignals++;
                        
                        const confidence = data.confidence;
                        pairConfidence += confidence;
                        totalConfidence += confidence;
                        
                        // Track individual indicator performance
                        if (indicatorPerformance[indicator]) {
                            indicatorPerformance[indicator].signals++;
                            indicatorPerformance[indicator].confidence += confidence;
                        }
                        
                        // Count consensus
                        if (data.suggestion === 'buy') bullish++;
                        else if (data.suggestion === 'sell') bearish++;
                    }
                });
                
                // Count strong consensus (>70% agreement)
                const total = bullish + bearish;
                if (total > 0 && (bullish / total > 0.7 || bearish / total > 0.7)) {
                    consensusCount++;
                }
            });
            
            // Calculate metrics
            const avgConfidence = totalSignals > 0 ? (totalConfidence / totalSignals) : 0;
            const consensusRate = allPairsData.pairs.length > 0 ? (consensusCount / allPairsData.pairs.length) : 0;
            
            // Find best performing indicator
            let bestIndicator = 'N/A';
            let bestScore = 0;
            Object.entries(indicatorPerformance).forEach(([indicator, perf]) => {
                if (perf.signals > 0) {
                    const score = perf.confidence / perf.signals;
                    if (score > bestScore) {
                        bestScore = score;
                        bestIndicator = INDICATOR_NAMES[indicator] || indicator;
                    }
                }
            });
            
            // Update display with color coding
            updateMetricDisplay('accuracy-rate', '87.3%', 'positive'); // Mock data
            updateMetricDisplay('total-signals', totalSignals.toString(), 'neutral');
            updateMetricDisplay('best-performer', bestIndicator, 'positive');
            updateMetricDisplay('avg-confidence', (avgConfidence * 100).toFixed(1) + '%', 
                avgConfidence > 0.7 ? 'positive' : avgConfidence > 0.4 ? 'neutral' : 'negative');
            updateMetricDisplay('consensus-rate', (consensusRate * 100).toFixed(1) + '%',
                consensusRate > 0.6 ? 'positive' : consensusRate > 0.3 ? 'neutral' : 'negative');
            updateMetricDisplay('volatility-index', 'Medium', 'warning'); // Mock data
        }

        function updateMetricDisplay(elementId, value, colorClass) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
                
                // Remove existing color classes
                element.classList.remove('metric-positive', 'metric-negative', 'metric-neutral', 'metric-warning');
                
                // Add appropriate color class
                if (colorClass) {
                    element.classList.add('metric-' + colorClass);
                }
            }
        }

        // Update your main updateDashboard function to include performance metrics
        function updateDashboard() {
            fetch('/api/data')
                .then(function(response) {
                    if (!response.ok) throw new Error('HTTP ' + response.status);
                    return response.json();
                })
                .then(function(data) {
                    updateSystemStatus(data);
                    updatePairs(data);
                    updatePerformanceMetrics(data); // Add this line
                    
                    if (!isOnline) {
                        isOnline = true;
                        document.getElementById('status-indicator').className = 'status-online';
                        console.log('‚úÖ Connected to trading bot');
                    }
                })
                .catch(function(error) {
                    console.error('‚ùå Failed to update dashboard:', error);
                    if (isOnline) {
                        isOnline = false;
                        document.getElementById('status-indicator').className = 'status-offline';
                    }
                });
        }

        function updateSystemStatus(data) {
            document.getElementById('uptime').textContent = data.uptime || '00:00:00';
            document.getElementById('total-data-points').textContent = 
                (data.stats && data.stats.dataCollection && data.stats.dataCollection.totalDataPoints) || 0;
            document.getElementById('data-status').textContent = 
                (data.stats && data.stats.dataCollection && data.stats.dataCollection.isCollecting) ? 'üü¢ Collecting' : 'üî¥ Stopped';
            document.getElementById('data-status').classList.remove('loading-pulse');
            document.getElementById('api-status').textContent = 'üü¢ Connected';
            document.getElementById('api-status').classList.remove('loading-pulse');
            document.getElementById('last-update').textContent = 
                data.lastUpdate ? new Date(data.lastUpdate).toLocaleTimeString() : 'Never';
        }

        function updatePairs(data) {
            var container = document.getElementById('pairs-container');
            
            data.pairs.forEach(function(pair) {
                var pairCard = document.getElementById('pair-' + pair);
                
                if (!pairCard) {
                    pairCard = createEnhancedPairCard(pair);
                    container.appendChild(pairCard);
                }
                
                updateEnhancedPairData(pair, data.history[pair], data.strategyResults[pair]);
            });
        }

        function createEnhancedPairCard(pair) {
            var col = document.createElement('div');
            col.className = 'col-lg-6 col-xl-4 mb-4';
            col.id = 'pair-' + pair;
            
            col.innerHTML = 
                '<div class="card h-100">' +
                    '<div class="card-header d-flex justify-content-between align-items-center">' +
                        '<div>' +
                            '<h6 class="mb-0">' + pair + '/USDT</h6>' +
                            '<small class="text-info" id="summary-' + pair + '">Loading...</small>' +
                        '</div>' +
                        '<span class="badge bg-secondary" id="price-' + pair + '">Loading...</span>' +
                    '</div>' +
                    '<div class="card-body">' +
                        '<div class="chart-container">' +
                            '<canvas id="chart-' + pair + '" class="price-chart"></canvas>' +
                        '</div>' +
                        
                        '<div class="ensemble-signal" id="ensemble-' + pair + '">' +
                            '<div class="d-flex justify-content-between align-items-center">' +
                                '<span class="fw-bold">Ensemble Signal</span>' +
                                '<span class="signal-strength" id="ensemble-signal-' + pair + '">-</span>' +
                            '</div>' +
                            '<div class="confidence-bar" id="ensemble-confidence-' + pair + '"></div>' +
                            '<small class="text-info" id="ensemble-summary-' + pair + '">Analyzing...</small>' +
                        '</div>' +
                        
                        '<div class="summary-stats" id="stats-' + pair + '">' +
                            '<div class="stat-item">' +
                                '<div class="stat-value text-success" id="bullish-' + pair + '">0</div>' +
                                '<div class="stat-label">Bullish</div>' +
                            '</div>' +
                            '<div class="stat-item">' +
                                '<div class="stat-value text-danger" id="bearish-' + pair + '">0</div>' +
                                '<div class="stat-label">Bearish</div>' +
                            '</div>' +
                            '<div class="stat-item">' +
                                '<div class="stat-value text-info" id="neutral-' + pair + '">0</div>' +
                                '<div class="stat-label">Neutral</div>' +
                            '</div>' +
                        '</div>' +
                        
                        '<ul class="nav nav-tabs" id="tabs-' + pair + '" role="tablist">' +
                            '<li class="nav-item" role="presentation">' +
                                '<button class="nav-link active" id="trend-tab-' + pair + '" data-bs-toggle="tab" data-bs-target="#trend-' + pair + '" type="button" role="tab">Trend</button>' +
                            '</li>' +
                            '<li class="nav-item" role="presentation">' +
                                '<button class="nav-link" id="momentum-tab-' + pair + '" data-bs-toggle="tab" data-bs-target="#momentum-' + pair + '" type="button" role="tab">Momentum</button>' +
                            '</li>' +
                            '<li class="nav-item" role="presentation">' +
                                '<button class="nav-link" id="volume-tab-' + pair + '" data-bs-toggle="tab" data-bs-target="#volume-' + pair + '" type="button" role="tab">Volume</button>' +
                            '</li>' +
                        '</ul>' +
                        
                        '<div class="tab-content mt-2" id="tabContent-' + pair + '">' +
                            '<div class="tab-pane fade show active" id="trend-' + pair + '" role="tabpanel"></div>' +
                            '<div class="tab-pane fade" id="momentum-' + pair + '" role="tabpanel"></div>' +
                            '<div class="tab-pane fade" id="volume-' + pair + '" role="tabpanel"></div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            
            return col;
        }

        function updateEnhancedPairData(pair, history, strategies) {
            if (!history || !history.closes || history.closes.length === 0) {
                return;
            }
            
            // Update price
            var latestPrice = history.closes[history.closes.length - 1];
            var priceElement = document.getElementById('price-' + pair);
            if (priceElement) {
                priceElement.textContent = '$' + latestPrice.toFixed(6);
                
                if (history.closes.length > 1) {
                    var prevPrice = history.closes[history.closes.length - 2];
                    var change = ((latestPrice - prevPrice) / prevPrice * 100).toFixed(2);
                    
                    if (latestPrice > prevPrice) {
                        priceElement.className = 'badge bg-success';
                        priceElement.textContent += ' (+' + change + '%)';
                    } else if (latestPrice < prevPrice) {
                        priceElement.className = 'badge bg-danger';
                        priceElement.textContent += ' (' + change + '%)';
                    } else {
                        priceElement.className = 'badge bg-secondary';
                    }
                }
            }
            
            // Update price chart
            updatePriceChart(pair, history);
            
            // Update strategies display
            updateStrategiesDisplay(pair, strategies);
        }

        function updateStrategiesDisplay(pair, strategies) {
            if (!strategies) {
                document.getElementById('ensemble-signal-' + pair).textContent = 'No Data';
                return;
            }
            
            // Calculate summary statistics
            var summary = calculateSummaryStats(strategies);
            
            // Update summary stats
            document.getElementById('bullish-' + pair).textContent = summary.bullish;
            document.getElementById('bearish-' + pair).textContent = summary.bearish;
            document.getElementById('neutral-' + pair).textContent = summary.neutral;
            
            // Update ensemble signal (you'll need to calculate this from your strategies)
            var ensembleSignal = calculateEnsembleSignal(strategies);
            updateEnsembleDisplay(pair, ensembleSignal);
            
            // Update tabbed indicators
            updateTabbedIndicators(pair, strategies);
        }

        function calculateSummaryStats(strategies) {
            var bullish = 0, bearish = 0, neutral = 0;
            
            Object.values(strategies).forEach(function(strategy) {
                if (strategy && !strategy.error) {
                    if (strategy.suggestion === 'buy') bullish++;
                    else if (strategy.suggestion === 'sell') bearish++;
                    else neutral++;
                }
            });
            
            return { bullish: bullish, bearish: bearish, neutral: neutral };
        }

        function calculateEnsembleSignal(strategies) {
            // Simple ensemble calculation - you can enhance this
            var buyScore = 0, sellScore = 0, totalConfidence = 0, validCount = 0;
            
            Object.entries(strategies).forEach(function([name, strategy]) {
                if (strategy && !strategy.error && strategy.confidence) {
                    validCount++;
                    var confidence = strategy.confidence;
                    
                    if (strategy.suggestion === 'buy') {
                        buyScore += confidence;
                    } else if (strategy.suggestion === 'sell') {
                        sellScore += confidence;
                    }
                    
                    totalConfidence += confidence;
                }
            });
            
            var avgConfidence = validCount > 0 ? totalConfidence / validCount : 0;
            var suggestion = buyScore > sellScore ? 'BUY' : sellScore > buyScore ? 'SELL' : 'HOLD';
            
            return {
                suggestion: suggestion,
                confidence: avgConfidence,
                buyScore: buyScore,
                sellScore: sellScore,
                validCount: validCount
            };
        }

        function updateEnsembleDisplay(pair, ensemble) {
            var signalElement = document.getElementById('ensemble-signal-' + pair);
            var confidenceElement = document.getElementById('ensemble-confidence-' + pair);
            var summaryElement = document.getElementById('ensemble-summary-' + pair);
            
            if (signalElement) {
                signalElement.textContent = ensemble.suggestion;
                signalElement.className = 'signal-strength';
                
                if (ensemble.suggestion === 'BUY') {
                    signalElement.classList.add('trend-up');
                } else if (ensemble.suggestion === 'SELL') {
                    signalElement.classList.add('trend-down');
                } else {
                    signalElement.classList.add('trend-neutral');
                }
            }
            
            if (confidenceElement) {
                var confidencePercent = (ensemble.confidence * 100);
                confidenceElement.style.width = confidencePercent + '%';
                
                if (confidencePercent > 70) {
                    confidenceElement.className = 'confidence-bar confidence-high';
                } else if (confidencePercent > 40) {
                    confidenceElement.className = 'confidence-bar confidence-medium';
                } else {
                    confidenceElement.className = 'confidence-bar confidence-low';
                }
            }
            
            if (summaryElement) {
                summaryElement.textContent = 
                    ensemble.validCount + ' indicators, ' + 
                    (ensemble.confidence * 100).toFixed(1) + '% confidence';
            }
        }

        function updateTabbedIndicators(pair, strategies) {
            // Update trend indicators
            var trendContent = '';
            INDICATOR_GROUPS.trend.forEach(function(indicator) {
                if (strategies[indicator]) {
                    trendContent += createIndicatorCard(indicator, strategies[indicator]);
                }
            });
            document.getElementById('trend-' + pair).innerHTML = trendContent;
            
            // Update momentum indicators
            var momentumContent = '';
            INDICATOR_GROUPS.momentum.forEach(function(indicator) {
                if (strategies[indicator]) {
                    momentumContent += createIndicatorCard(indicator, strategies[indicator]);
                }
            });
            document.getElementById('momentum-' + pair).innerHTML = momentumContent;
            
            // Update volume indicators
            var volumeContent = '';
            INDICATOR_GROUPS.volume.forEach(function(indicator) {
                if (strategies[indicator]) {
                    volumeContent += createIndicatorCard(indicator, strategies[indicator]);
                }
            });
            document.getElementById('volume-' + pair).innerHTML = volumeContent;
        }

        function createIndicatorCard(indicator, data) {
            if (data.error) {
                return '<div class="indicator-card">' +
                       '<div class="d-flex justify-content-between">' +
                       '<strong>' + INDICATOR_NAMES[indicator] + '</strong>' +
                       '<span class="badge bg-secondary">ERROR</span>' +
                       '</div></div>';
            }
            
            var confidence = (data.confidence * 100).toFixed(1);
            var badgeClass = 'badge-' + data.suggestion;
            
            // Get indicator-specific value display
            var valueDisplay = getIndicatorValueDisplay(indicator, data);
            
            return '<div class="indicator-card">' +
                   '<div class="d-flex justify-content-between align-items-center mb-1">' +
                   '<strong>' + INDICATOR_NAMES[indicator] + '</strong>' +
                   '<span class="badge ' + badgeClass + '">' + data.suggestion.toUpperCase() + '</span>' +
                   '</div>' +
                   '<div class="d-flex justify-content-between align-items-center">' +
                   '<small class="text-info">' + valueDisplay + '</small>' +
                   '<small class="text-info">' + confidence + '%</small>' +
                   '</div>' +
                   '<div class="confidence-bar ' + 
                   (data.confidence > 0.7 ? 'confidence-high' : 
                    data.confidence > 0.4 ? 'confidence-medium' : 'confidence-low') + 
                   '" style="width: ' + confidence + '%"></div>' +
                   '</div>';
        }

        function getIndicatorValueDisplay(indicator, data) {
            switch(indicator) {
                case 'rsi':
                    return 'RSI: ' + (data.value || 0).toFixed(1);
                case 'macd':
                    return 'Histogram: ' + (data.histogram || 0).toFixed(6);
                case 'bollinger':
                    return '%B: ' + (data.percentB || 0).toFixed(3);
                case 'ma':
                    return 'Spread: ' + (data.spreadPercent || 0).toFixed(2) + '%';
                case 'volume':
                    return 'Ratio: ' + (data.volumeRatio || 0).toFixed(1) + 'x';
                case 'stochastic':
                    return '%K: ' + (data.k || 0).toFixed(1) + ', %D: ' + (data.d || 0).toFixed(1);
                case 'williamsR':
                    return '%R: ' + (data.value || 0).toFixed(1) + '%';
                case 'ichimoku':
                    return 'Cloud: ' + (data.cloudColor || 'neutral');
                case 'adx':
                    return 'ADX: ' + (data.adx || 0).toFixed(1) + ' (' + (data.metadata?.trendStrength || 'Unknown') + ')';
                case 'cci':
                    return 'CCI: ' + (data.cci || 0).toFixed(1);
                case 'parabolicSAR':
                    return 'SAR: ' + (data.sar || 0).toFixed(6) + ' (' + (data.trend || 'unknown') + ')';
                default:
                    return 'N/A';
            }
        }

        function updatePriceChart(pair, history) {
            var ctx = document.getElementById('chart-' + pair);
            if (!ctx) return;
            
            var labels = history.timestamps.slice(-50).map(function(t) {
                return new Date(t).toLocaleTimeString();
            });
            var prices = history.closes.slice(-50);
            
            if (charts['price-' + pair]) {
                charts['price-' + pair].data.labels = labels;
                charts['price-' + pair].data.datasets[0].data = prices;
                charts['price-' + pair].update('none');
            } else {
                charts['price-' + pair] = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Price',
                            data: prices,
                            borderColor: '#58a6ff',
                            backgroundColor: 'rgba(88, 166, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { 
                                display: false,
                                grid: { color: '#30363d' }
                            },
                            y: { 
                                beginAtZero: false,
                                grid: { color: '#30363d' },
                                ticks: { 
                                    color: '#8b949e', 
                                    maxTicksLimit: 5,
                                    callback: function(value) {
                                        return '$' + value.toFixed(6);
                                    }
                                }
                            }
                        },
                        elements: {
                            point: { radius: 0, hoverRadius: 6 },
                            line: { borderWidth: 2 }
                        },
                        animation: { duration: 300 }
                    }
                });
            }
        }

        // Initialize Bootstrap tabs functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Bootstrap tabs will work automatically with data-bs-toggle attributes
        });

        // Start dashboard updates
        setInterval(updateDashboard, 3000);
        updateDashboard();
        
        console.log('üöÄ Advanced Trading Bot Dashboard Loaded');
        console.log('Features: 11 Indicators, Tabbed Interface, Ensemble Signals, Confidence Bars');
    </script>
    
    <!-- Bootstrap JS for tabs functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    
    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">‚öôÔ∏è Dashboard Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Update Frequency</label>
                        <select class="form-select bg-dark text-white border-secondary" id="update-frequency">
                            <option value="1000">1 second</option>
                            <option value="3000" selected>3 seconds</option>
                            <option value="5000">5 seconds</option>
                            <option value="10000">10 seconds</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="sound-alerts" checked>
                            <label class="form-check-label" for="sound-alerts">Sound Alerts</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="push-notifications" checked>
                            <label class="form-check-label" for="push-notifications">Push Notifications</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Confidence Threshold for Alerts</label>
                        <input type="range" class="form-range" min="0.1" max="1" step="0.1" value="0.7" id="confidence-threshold">
                        <div class="d-flex justify-content-between">
                            <small>10%</small>
                            <small id="threshold-display">70%</small>
                            <small>100%</small>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Theme</label>
                        <select class="form-select bg-dark text-white border-secondary" id="theme-select">
                            <option value="dark" selected>Dark (GitHub)</option>
                            <option value="light">Light</option>
                            <option value="blue">Blue</option>
                            <option value="green">Matrix Green</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-settings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Button (add to navbar) -->
    <script>
    // Add settings button to navbar
    document.addEventListener('DOMContentLoaded', function() {
        const navbar = document.querySelector('.navbar-nav');
        const settingsButton = document.createElement('button');
        settingsButton.className = 'btn btn-outline-light btn-sm me-2';
        settingsButton.innerHTML = '‚öôÔ∏è';
        settingsButton.setAttribute('data-bs-toggle', 'modal');
        settingsButton.setAttribute('data-bs-target', '#settingsModal');
        navbar.insertBefore(settingsButton, navbar.firstChild);
        
        // Settings functionality
        setupSettings();
    });

    function setupSettings() {
        // Load saved settings
        loadSettings();
        
        // Save settings handler
        document.getElementById('save-settings').addEventListener('click', saveSettings);
        
        // Real-time threshold display
        document.getElementById('confidence-threshold').addEventListener('input', function(e) {
            document.getElementById('threshold-display').textContent = 
                Math.round(e.target.value * 100) + '%';
        });
    }

    function loadSettings() {
        const settings = JSON.parse(localStorage.getItem('dashboardSettings') || '{}');
        
        if (settings.updateFrequency) {
            document.getElementById('update-frequency').value = settings.updateFrequency;
            // Update the actual interval
            clearInterval(window.dashboardInterval);
            window.dashboardInterval = setInterval(updateDashboard, parseInt(settings.updateFrequency));
        }
        
        if (settings.soundAlerts !== undefined) {
            document.getElementById('sound-alerts').checked = settings.soundAlerts;
            if (window.alertSystem) {
                window.alertSystem.soundEnabled = settings.soundAlerts;
            }
        }
        
        if (settings.confidenceThreshold) {
            document.getElementById('confidence-threshold').value = settings.confidenceThreshold;
            document.getElementById('threshold-display').textContent = 
                Math.round(settings.confidenceThreshold * 100) + '%';
        }
    }

    function saveSettings() {
        const settings = {
            updateFrequency: document.getElementById('update-frequency').value,
            soundAlerts: document.getElementById('sound-alerts').checked,
            pushNotifications: document.getElementById('push-notifications').checked,
            confidenceThreshold: document.getElementById('confidence-threshold').value,
            theme: document.getElementById('theme-select').value
        };
        
        localStorage.setItem('dashboardSettings', JSON.stringify(settings));
        
        // Apply settings
        loadSettings();
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('settingsModal'));
        modal.hide();
        
        // Show success message
        showToast('Settings saved successfully!', 'success');
    }

    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        `;
        
        const container = document.getElementById('alerts-container') || document.body;
        container.appendChild(toast);
        
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        setTimeout(() => toast.remove(), 5000);
    }
    </script>

</body>
</html>